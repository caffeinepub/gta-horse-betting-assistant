{
  "kind": "build_request",
  "title": "Define modelState storage schema with comprehensive signal weights and learning parameters",
  "projectName": "GTA Horse Betting Assistant",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-36",
      "text": "Update frontend/src/types/storage.ts to expand the ModelState interface with a nested signalWeights object containing oddsWeight (number), historicalBucketWeight (number), recentBucketWeight (number), and consistencyWeight (number) fields",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "signalWeights: oddsWeight historicalBucketWeight recentBucketWeight consistencyWeight"
        ]
      },
      "acceptanceCriteria": [
        "ModelState interface includes a signalWeights object with four numeric weight fields",
        "All weight fields are typed as number",
        "TypeScript compilation succeeds with no type errors"
      ]
    },
    {
      "id": "REQ-37",
      "text": "Add calibrationScalar (number), confidenceScalingFactor (number), recentAccuracyWindow (number), driftDetectionState (object or appropriate type), and raceCount (number) fields to the ModelState interface in frontend/src/types/storage.ts",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "calibrationScalar confidenceScalingFactor recentAccuracyWindow driftDetectionState raceCount"
        ]
      },
      "acceptanceCriteria": [
        "ModelState interface includes all five additional fields with correct types",
        "driftDetectionState is typed as an appropriate structure (object or custom interface)",
        "All numeric fields are typed as number",
        "TypeScript compilation succeeds"
      ]
    },
    {
      "id": "REQ-38",
      "text": "Update frontend/src/lib/storage.ts AsyncStorage implementation to initialize modelState with default values for all fields (signalWeights with default weight values, calibrationScalar, confidenceScalingFactor, recentAccuracyWindow, driftDetectionState, raceCount) when no existing modelState is found in localStorage",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ]
      },
      "acceptanceCriteria": [
        "readModelState function returns a complete ModelState object with all fields populated",
        "Default values are sensible starting points for the learning system",
        "No undefined or null values in the returned modelState structure"
      ]
    },
    {
      "id": "REQ-39",
      "text": "Add a writeModelState function to frontend/src/lib/storage.ts that accepts a ModelState object and persists it to AsyncStorage under the 'modelState' key with immutability enforcement",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ]
      },
      "acceptanceCriteria": [
        "writeModelState function accepts a ModelState parameter and saves it to localStorage",
        "Function enforces immutability by deep freezing the stored object",
        "Function triggers storage change listeners to notify subscribers",
        "Function returns success or failure status"
      ]
    },
    {
      "id": "REQ-40",
      "text": "Update frontend/src/lib/statsCalculator.ts to add functions that compute updated signal weights and calibration parameters from race records, preparing for future integration with the prediction system",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ]
      },
      "acceptanceCriteria": [
        "Functions accept an array of RaceRecord and current ModelState as inputs",
        "Functions return updated ModelState with recalculated signal weights and parameters",
        "Calculation logic is pure and deterministic",
        "Functions include TypeScript type safety for all inputs and outputs"
      ]
    }
  ],
  "constraints": [
    "Do not modify backend Motoko files; modelState is frontend-only storage",
    "Maintain compatibility with existing AsyncStorage structure (races, bettingHistory, oddsBucketStats)",
    "Preserve immutability constraints on all stored data",
    "Do not alter the four-bucket odds range system (1-2, 3-5, 6-10, 11-30)"
  ],
  "nonGoals": [
    "Implementing the prediction logic that uses signal weights (separate future requirement)",
    "Creating UI components to display or edit modelState parameters",
    "Integrating modelState updates with race logging workflow",
    "Defining specific default values for signal weights and calibration parameters"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}